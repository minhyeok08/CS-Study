# 캐시

### 정의

자주 사용되는 데이터나 값을 DB에서 복사하여 두는 임시 저장소

### 사용 이유

<img src="https://velog.velcdn.com/images/hyejin4169/post/310b51e9-768b-43b1-a146-dd4c58a69233/image.png" width="800" height="400">

<br>

- 캐시는 저장 공간이 작고, 비용이 비싸지만 빠른 성능을 제공한다.

- 따라서, 자주 사용하거나 반복적으로 사용하는 데이터는 캐시에 저장하여 효율적이고 빠르게 데이터에 접근할 수 있다.

<br>

<img src="https://velog.velcdn.com/images/hyejin4169/post/d1c597b1-c387-491e-89ca-b01a5beaaf05/image.png" width="800" height="400">

<br>

파레토 법칙

- 파레토의 법칙(80/20 법칙)은 전체 결과의 80%가 전체 원인의 20%에서 발생한다는 이론.

- 이를 데이터 접근에 적용하면, 전체 데이터 중 일부(약 20%)만 빈번하게(약 80%) 접근된다는 것을 의미.

## 캐시 사용전략

- cache hit : 캐시 스토어(redis)에 데이터가 있을 경우 바로 가져옴 (빠름)

- cache miss : 캐시 스토어(redis)에 데이터가 없을 경우 DB에서 가져옴 (느림)

### Read 전략

### Look Aside 패턴

<img src="https://velog.velcdn.com/images/hwaya2828/post/ed177483-4566-4286-95ff-427bbf00ccd5/image.png" width="800" height="400">

#### 작동원리

데이터를 찾을때 우선 캐시에 저장된 데이터가 있는지 우선적으로 확인하는 전략. 만일 캐시에 데이터가 없으면 DB에서 조회함.

#### 장점

- 반복적이고 자주 데이터를 읽는 경우 사용하는 경우 적합하다.

- redis에 오류가 생기더라도 DB에서 데이터를 가져올 수 있어서 서비스 자체에는 문제가 없다.

#### 단점

- 캐시에 Connection이 많다면 redis 오류시 한번에 많은 요청이 DB에 가기 때문에 부하가 걸린다.

- 업데이트를 매번하지 않기 때문에, 캐시에 있는 데이터와 DB에 있는 데이터가 일치하지 않는 정합성 문제가 발생.

- 첫 데이터 조회시 DB에 접근해야하므로 단 건의 데이터 조회에는 적합하지 않다.

    - Cache Warming
  
            미리 cache로 db의 데이터를 밀어 넣어두는 작업을 의미.
            
            Cache Warming을 수행하지 않으면, 서비스 초기(첫 페이지와 같이 조회가 몰려오는 부분)에 트래픽 급증시 대량의 cache miss 가 발생하여 데이터베이스 부하가 급증 할 수 있다. (Thundering Herd)
            
            다만, 캐시 자체는 용량이 작아 일정시간이 지나면 expire 된다. 따라서, 캐시의 TTL을 잘 조정할 필요가 있다.

<br>

### Write 전략

### Write Back 패턴

<img src="https://velog.velcdn.com/images/hwaya2828/post/6118de52-4950-4ab5-afeb-27bbdc964e97/image.png" width="800" height="400">

#### 작동 원리

데이터가 변경될 때마다 캐시에 변경사항을 즉시 반영하지만, DB에는 바로 반영하지 않는다. 대신 변경사항을 캐시에 먼저 저장해 두고, 일정 시간이나 특정 조건이 충족될 때 데이터베이스에 변경사항을 일괄적으로 업데이트한다.

#### 장점

- Write가 빈번하면서 Read를 하는데 많은 양의 Resource가 소모되는 서비스에 적합

- DB 쓰기 횟수 비용과 부하 감소
  
    - 데이터를 캐시에 모아두었다가 일정 주기에 따라 데이터베이스에 한 번에 쓰기 때문에, 데이터베이스에 대한 쓰기 횟수와 부하를 줄일 수 있다.

- 데이터 정합성 확보

    - 캐시에 먼저 데이터를 저장하고, 이후에 데이터베이스에 반영하므로 캐시와 데이터베이스 사이에서 데이터의 일관성을 유지할 수 있다.

- 데이터베이스 장애에도 서비스 지속 가능
  
    - 데이터베이스에 장애가 발생하더라도 캐시에 데이터가 저장되어 있어, 일정 시간 동안 서비스를 계속 제공할 수 있다.

#### 단점

- 자주 사용되지 않는 데이터의 불필요한 저장
  
  - 캐시에 데이터가 일정 시간 동안 머무르게 되므로, 자주 사용되지 않는 데이터도 캐시에 저장되어 있어 리소스를 비효율적으로 사용할 수 있다.

- 캐시 장애 시 데이터 유실 가능성
  
  - 캐시에 문제가 발생하면 아직 데이터베이스에 반영되지 않은 변경사항이 손실될 수 있다.

캐시의 장점과 단점은 무엇인가요?

캐시의 가장 큰 장점은 데이터 접근 속도를 향상시킨다는 것입니다. 이로 인해 전체 시스템의 성능을 향상시킬 수 있습니다. 하지만 캐시의 단점으로는 저장 공간이 제한적이라는 점과, 캐시 데이터와 원본 데이터 간의 동기화 문제가 발생할 수 있다는 점을 들 수 있습니다.








